{"version":3,"file":"perf-zip-cli.js","sourceRoot":"","sources":["../../../../src/_utils/perf-zip-cli.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from \"fs\";\nimport * as path from \"path\";\n\nimport { Stream } from \"stream\";\n\n// ZIP 1\nimport StreamZip = require(\"node-stream-zip\");\n\n// ZIP 2\nimport * as yauzl from \"yauzl\";\n\n// ZIP 3\nimport * as unzipper from \"unzipper\";\n\n// import * as filehound from \"filehound\";\n\nconsole.log(\"process.cwd():\");\nconsole.log(process.cwd());\n\nconsole.log(\"__dirname:\");\nconsole.log(__dirname);\n\nconst args = process.argv.slice(2);\nconsole.log(\"args:\");\nconsole.log(args);\n\nif (!args[0]) {\n    console.log(\"FILEPATH ARGUMENT IS MISSING.\");\n    process.exit(1);\n}\nconst argPath = args[0].trim();\nlet filePath = argPath;\nconsole.log(filePath);\nif (!fs.existsSync(filePath)) {\n    filePath = path.join(__dirname, argPath);\n    console.log(filePath);\n    if (!fs.existsSync(filePath)) {\n        filePath = path.join(process.cwd(), argPath);\n        console.log(filePath);\n        if (!fs.existsSync(filePath)) {\n            console.log(\"FILEPATH DOES NOT EXIST.\");\n            process.exit(1);\n        }\n    }\n}\n\nconst stats = fs.lstatSync(filePath);\nif (!stats.isFile() && !stats.isDirectory()) {\n    console.log(\"FILEPATH MUST BE FILE OR DIRECTORY.\");\n    process.exit(1);\n}\n\nconst fileName = path.basename(filePath);\nconst ext = path.extname(fileName).toLowerCase();\n\nconst VERBOSE = process.env.DEBUG || false;\n\nconst argIterations = args[1] ? args[1].trim() : undefined;\nconst N_ITERATIONS = argIterations ? parseInt(argIterations, 10) : 5;\n\nconst argExtra = args[2] ? args[2].trim() : undefined;\nconst CHECK_ONLY_ZIP3 = argExtra === \"1\";\n\n// node-stream-zip\nconst zip1 = async (file: string): Promise<void> => {\n    return new Promise<void>((resolve, reject) => {\n\n        const zip = new StreamZip({\n            file,\n            storeEntries: true,\n        });\n\n        zip.on(\"error\", (err: any) => {\n            console.log(\"--ZIP error: \" + filePath);\n            console.log(err);\n\n            reject(err);\n        });\n\n        zip.on(\"entry\", (_entry: any) => {\n            // console.log(\"--ZIP: entry\");\n            // console.log(entry.name);\n        });\n\n        zip.on(\"extract\", (entry: any, f: any) => {\n            console.log(\"--ZIP extract:\");\n            console.log(entry.name);\n            console.log(f);\n        });\n\n        zip.on(\"ready\", async () => {\n            // console.log(\"--ZIP: ready\");\n            // console.log(zip.entriesCount);\n\n            const zipEntries = Object.values(zip.entries()) as any[];\n\n            if (VERBOSE) {\n                process.stdout.write(\"## 1 ##\\n\");\n            }\n            for (const zipEntry of zipEntries) {\n                if (zipEntry.isDirectory) {\n                    continue;\n                }\n                const promize = new Promise((res, rej) => {\n                    zip.stream(zipEntry.name, async (err: any, stream: Stream | undefined) => {\n                        if (err) {\n                            console.log(err);\n                            rej(err);\n                            return;\n                        }\n                        // stream.pipe(process.stdout);\n                        const totalBytes = streamReadAll(stream as NodeJS.ReadableStream);\n                        process.nextTick(() => {\n                            res(totalBytes);\n                        });\n                    });\n                });\n                const size = await promize;\n                if (zipEntry.size !== size) {\n                    console.log(`1 SIZE MISMATCH? ${zipEntry.name} ${zipEntry.size} != ${size}`);\n                }\n\n                if (VERBOSE) {\n                    process.stdout.write(` ${zipEntry.name} `);\n                } else {\n                    process.stdout.write(\".\");\n                }\n            }\n            process.stdout.write(\"\\n\");\n\n            process.nextTick(() => {\n                zip.close();\n                process.nextTick(() => {\n                    resolve();\n                });\n            });\n        });\n    });\n};\n(zip1 as any).zipName = \"node-stream-zip\";\n\n// yauzl\nconst zip2 = async (file: string): Promise<void> => {\n    return new Promise<void>((resolve, reject) => {\n        yauzl.open(file, { lazyEntries: true, autoClose: false }, (error, zip) => {\n            if (error || !zip) {\n                console.log(\"yauzl init ERROR\");\n                console.log(error);\n                reject(error);\n                return;\n            }\n\n            zip.on(\"error\", (erro) => {\n                console.log(\"yauzl ERROR\");\n                console.log(erro);\n                reject(erro);\n            });\n\n            if (VERBOSE) {\n                process.stdout.write(\"## 2 ##\\n\");\n            }\n\n            zip.readEntry(); // next (lazyEntries)\n            zip.on(\"entry\", async (zipEntry) => {\n                // if (/\\/$/.test(entry.fileName)) {\n                if (zipEntry.fileName[zipEntry.fileName.length - 1] === \"/\") {\n                    // skip directories / folders\n                } else {\n                    const promize = new Promise((res, rej) => {\n                        zip.openReadStream(zipEntry, (err, stream) => {\n                            if (err || !stream) {\n                                console.log(err);\n                                rej(err);\n                                return;\n                            }\n                            // stream.pipe(process.stdout);\n                            const totalBytes = streamReadAll(stream);\n                            process.nextTick(() => {\n                                res(totalBytes);\n                            });\n                        });\n                    });\n                    const size = await promize;\n                    if (zipEntry.uncompressedSize !== size) {\n                        // tslint:disable-next-line:max-line-length\n                        console.log(`2 SIZE MISMATCH? ${zipEntry.fileName} ${zipEntry.uncompressedSize} != ${size}`);\n                    }\n\n                    if (VERBOSE) {\n                        process.stdout.write(` ${zipEntry.fileName} `);\n                    } else {\n                        process.stdout.write(\".\");\n                    }\n                }\n\n                zip.readEntry(); // next (lazyEntries)\n            });\n\n            zip.on(\"end\", () => {\n                // console.log(\"yauzl END\");\n\n                process.stdout.write(\"\\n\");\n\n                process.nextTick(() => {\n                    zip.close(); // not autoClose\n                    process.nextTick(() => {\n                        resolve();\n                    });\n                });\n            });\n\n            zip.on(\"close\", () => {\n                // console.log(\"yauzl CLOSE\");\n            });\n        });\n    });\n};\n(zip2 as any).zipName = \"yauzl\";\n\n// <<< UNZIPPER_BUG\n// https://github.com/ZJONSSON/node-unzipper/issues/104\n// events.js:174\n// throw er; // Unhandled 'error' event\n// Error: EBADF: bad file descriptor, read\n// Emitted 'error' event at:\n// at lazyFs.read (internal/fs/streams.js:165:12)\n// at FSReqWrap.wrapper [as oncomplete] (fs.js:467:17)\n// const streams: any = {};\n// >>> UNZIPPER_BUG\n\n// unzipper\nconst zip3 = async (file: string): Promise<void> => {\n    return new Promise<void>(async (resolve, reject) => {\n        let zip: any;\n        try {\n            zip = await unzipper.Open.file(file);\n        } catch (err) {\n            console.log(err);\n            reject(err);\n            return;\n        }\n        if (VERBOSE) {\n            process.stdout.write(\"## 3 ##\\n\");\n        }\n        for (const zipEntry of zip.files) {\n            if (zipEntry.type === \"Directory\") {\n                continue;\n            }\n            const stream = zipEntry.stream();\n\n            // <<< UNZIPPER_BUG\n            stream.on(\"error\", (err: any) => {\n                console.log(\"err1\");\n                console.log(err);\n            });\n            // stream.__ZIP_FILE_PATH = file;\n            // stream.__ZIP_RESOURCE_PATH = zipEntry.path;\n            // if (!streams[file]) {\n            //     streams[file] = {};\n            // }\n            // streams[file][zipEntry.path] = stream; // prevents premature garbage collection\n\n            // // event sequence: FINISH, then END\n            // stream.on(\"end\", () => {\n            //     // console.log(`${zipEntry.path} END`);\n\n            //     process.nextTick(() => {\n            //         // console.log(`${stream.__ZIP_FILE_PATH} ${stream.__ZIP_RESOURCE_PATH} CLEAN`);\n            //         // streams[stream.__ZIP_FILE_PATH][stream.__ZIP_RESOURCE_PATH] = null;\n            //         delete streams[stream.__ZIP_FILE_PATH][stream.__ZIP_RESOURCE_PATH];\n            //     });\n\n            //     // setTimeout(() => {\n            //     //     return stream; // prevents premature garbage collection\n            //     // }, 200);\n            // });\n            // >>> UNZIPPER_BUG\n\n            const promize = streamReadAll(stream);\n            let size: number;\n            try {\n                size = await promize;\n            } catch (err) {\n                console.log(\"err2\");\n                console.log(err);\n                reject(err);\n                return;\n            }\n\n            if (zipEntry.uncompressedSize !== size) {\n                console.log(`3 SIZE MISMATCH? ${zipEntry.path} ${zipEntry.uncompressedSize} != ${size}`);\n            }\n\n            if (VERBOSE) {\n                process.stdout.write(` ${zipEntry.path} `);\n            } else {\n                process.stdout.write(\".\");\n            }\n        }\n        process.stdout.write(\"\\n\");\n\n        // <<< UNZIPPER_BUG\n        // process.nextTick(() => {\n        //     // streams[file] = null;\n        //     delete streams[file];\n        // });\n        // >>> UNZIPPER_BUG\n\n        resolve();\n    });\n};\n(zip3 as any).zipName = \"unzipper\";\n\nconst zips = CHECK_ONLY_ZIP3 ? [zip3] : [zip1, zip2, zip3];\n\nasync function processFile(file: string) {\n    console.log(`=====================================`);\n    console.log(`${file}`);\n    console.log(`=====================================`);\n\n    let winner = 0;\n    let minNanoOverall = Number.MAX_SAFE_INTEGER;\n\n    let iZip = 0;\n    for (const zip of zips) {\n        iZip++;\n\n        if (VERBOSE) {\n            console.log(`-------------------------------`);\n        }\n        for (let i = 0; i < N_ITERATIONS; i++) {\n            process.stdout.write(`${i + 1}/${N_ITERATIONS} `);\n\n            const time = process.hrtime();\n            await zip(file);\n            const diffTime = process.hrtime(time);\n\n            // await new Promise((res, _rej) => {\n            //     setTimeout(() => {\n            //         res();\n            //     }, 100);\n            // });\n\n            const nanos = diffTime[0] * 1e9 + diffTime[1];\n            (zip as any).minNano = nanos;\n            if (nanos < minNanoOverall) {\n                minNanoOverall = nanos;\n                winner = iZip;\n            }\n\n            if (VERBOSE) {\n                // tslint:disable-next-line:max-line-length\n                console.log(`Zip ${iZip}: ${diffTime[0]} seconds + ${diffTime[1]} nanoseconds`);\n            }\n        }\n    }\n\n    if (VERBOSE) {\n        console.log(`=====================================`);\n    }\n\n    iZip = 0;\n    for (const zip of zips) {\n        iZip++;\n        const won = iZip === winner;\n        // tslint:disable-next-line:max-line-length\n        console.log(`${won ? \">>\" : \"--\"} Zip ${iZip} (${(zip as any).zipName}) => ${(zip as any).minNano.toLocaleString()} nanoseconds ${won ? \" [ WINNER ]\" : `[ +${((zip as any).minNano - minNanoOverall).toLocaleString()} ]`}`);\n    }\n}\n\nif (stats.isDirectory()) {\n\n    // tslint:disable-next-line:no-floating-promises\n    (async () => {\n        // const files: string[] = await filehound.create()\n        //     .discard(\"node_modules\")\n        //     // .depth(5)\n        //     .paths(filePath)\n        //     .ext([\".zip\", \".epub\", \".cbz\"])\n        //     // .directory()\n        //     .find();\n        const files = fs.readdirSync(filePath, { withFileTypes: true }).\n            filter((f) => f.isFile() && /\\.(epub3?)|(zip)|(cbz)$/.test(f.name)).map((f) => path.join(filePath, f.name));\n\n        for (const file of files) {\n            await processFile(file);\n        }\n    })();\n\n} else if (/\\.(zip|epub|cbz)$/.test(ext)) {\n    // tslint:disable-next-line:no-floating-promises\n    (async () => {\n        await processFile(filePath);\n    })();\n}\n\nasync function streamReadAll(readStream: NodeJS.ReadableStream): Promise<number> {\n\n    return new Promise<number>((resolve, reject) => {\n\n        let totalBytes = 0;\n\n        const cleanup = () => {\n            readStream.removeListener(\"data\", handleData);\n            readStream.removeListener(\"error\", handleError);\n            readStream.removeListener(\"end\", handleEnd);\n        };\n\n        const handleError = (err: any) => {\n            cleanup();\n            reject(err);\n        };\n        readStream.on(\"error\", handleError);\n\n        const handleData = (data: Buffer) => {\n            totalBytes += data.length;\n        };\n        readStream.on(\"data\", handleData);\n\n        const handleEnd = () => {\n            cleanup();\n            resolve(totalBytes);\n        };\n        readStream.on(\"end\", handleEnd);\n    });\n}\n"]}